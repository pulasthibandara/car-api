# --- !Ups

CREATE TABLE USERS (
  ID varchar(36) NOT NULL,
  EMAIL varchar NOT NULL,
  FIRST_NAME varchar NOT NULL,
  LAST_NAME varchar NOT NULL,
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (ID)
);

-- A User can have multiple passwords with with different hasing algorithms
CREATE TABLE LOGIN_INFO (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
  PROVIDER_ID VARCHAR NOT NULL,
  PROVIDER_KEY VARCHAR NOT NULL,
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Mapping table between USER and LOGIN_INFO
CREATE TABLE USER_LOGIN_INFO (
  USER_ID VARCHAR NOT NULL,
  LOGIN_INFO_ID BIGINT NOT NULL,
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Credentials based login info
CREATE TABLE PASSWORD_INFO (
  HASHER VARCHAR NOT NULL,
  PASSWORD VARCHAR NOT NULL,
  SALT VARCHAR,
  LOGIN_INFO_ID BIGINT NOT NULL,
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO USERS VALUES ('9b35c0de-52df-47ec-b7d6-2b58aff11b33', 'Mario', 'Joseph', 'mario@example.com', DEFAULT);
INSERT INTO USERS VALUES ('fae30853-de15-4f62-9a0f-58601a72c42c', 'Fred', 'Martin', 'fred@flinstones.com', DEFAULT);

# --- !Downs

DROP TABLE PASSWORD_INFO;
DROP TABLE USER_LOGIN_INFO;
DROP TABLE LOGIN_INFO;
DROP TABLE USERS;
